#!/usr/bin/env bash

source "$HOME/scripts/acc/init-backend-setup.sh"

service='accumulus-identity-service'
repo="$HOME/repos/$service"
profile='sponsor'
if [[ "$profile" == sponsor* ]]; then
	export S2S_CLIENT_SECRET=$SPONSOR_S2S_CLIENT_SECRET
elif [[ "$profile" == hacollab* ]]; then
	export S2S_CLIENT_SECRET=$HACOLLAB_S2S_CLIENT_SECRET
fi
if pgrep -f "$service"; then
	acc-stop-identity
fi

cd "$repo" || exit 1

gw bootRun --args="--spring.profiles.active=$profile,admin-data-reset" &
